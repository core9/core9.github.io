$(function(){var t=function(t,i,s){this.containerSelector=t,this.width=i,this.height=s,this.loaderInterval=null,this.loaderOffset=0,this.ctx=this.initCanvas(t,i,s),this.startLoader("Loading graph data"),this.loadMeta()};t.prototype={initCanvas:function(t){var i=$(t).find("canvas")[0];i.style.zIndex="0";var s=i.width,e=i.height,h=i.getContext("2d"),o=window.devicePixelRatio||1,a=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1,r=o/a;return 1===r?h:(i.width=s*r,i.height=e*r,i.style.width=s+"px",i.style.height=e+"px",h.scale(r,r),h)},startLoader:function(t){this.ctx.save(),this.ctx.font="14px Monaco, monospace",this.ctx.fillStyle="#cacaca",this.ctx.textAlign="center",this.ctx.fillText(t,this.width/2,155),this.ctx.restore(),this.displayLoader()},stopLoader:function(){$(".large-loading-area").hide()},displayLoader:function(){$(".large-loading-area").show()},loadMeta:function(){var t=$.ajaxPoll({url:$(this.containerSelector).attr("data-network-graph-meta-url")}),i=function(t){$(this.containerSelector).length&&($(".js-network-poll").hide(),$(".js-network-current").show(),this.init(t))}.bind(this),s=function(){console.log("network graph polling failed")};t.then(i,s)},init:function(i){this.focus=i.focus,this.nethash=i.nethash,this.spaceMap=i.spacemap,this.userBlocks=i.blocks,this.commits=[];for(var s=0;s<i.dates.length;s++)this.commits.push(new t.Commit(s,i.dates[s]));this.users={};for(var s=0;s<i.users.length;s++){var e=i.users[s];this.users[e.name]=e}this.chrome=new t.Chrome(this,this.ctx,this.width,this.height,this.focus,this.commits,this.userBlocks,this.users),this.graph=new t.Graph(this,this.ctx,this.width,this.height,this.focus,this.commits,this.users,this.spaceMap,this.userBlocks,this.nethash),this.mouseDriver=new t.MouseDriver(this.containerSelector,this.chrome,this.graph),this.keyDriver=new t.KeyDriver(this.containerSelector,this.chrome,this.graph),this.stopLoader(),this.graph.drawBackground(),this.chrome.draw(),this.graph.requestInitialChunk()},initError:function(){this.stopLoader(),this.ctx.clearRect(0,0,this.width,this.height),this.startLoader("Graph could not be drawn due to a network IO problem.")}},t.Commit=function(t,i){this.time=t,this.date=moment(i,"YYYY-MM-DD HH:mm:ss"),this.requested=null,this.populated=null},t.Commit.prototype={populate:function(t,i,s){this.user=i,this.author=t.author,this.date=moment(t.date,"YYYY-MM-DD HH:mm:ss"),this.gravatar=t.gravatar,this.id=t.id,this.login=t.login,this.message=t.message,this.space=t.space,this.time=t.time,this.parents=this.populateParents(t.parents,s),this.requested=!0,this.populated=new Date},populateParents:function(t,i){for(var s=[],e=0;e<t.length;e++){var h=t[e],o=i[h[1]];o.id=h[0],o.space=h[2],s.push(o)}return s}},t.Chrome=function(t,i,s,e,h,o,a,r){this.namesWidth=100,this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.userBgColors=["#EBEBFF","#E0E0FF"],this.network=t,this.ctx=i,this.width=s,this.height=e,this.commits=o,this.userBlocks=a,this.users=r,this.offsetX=this.namesWidth+(s-this.namesWidth)/2-20*h,this.offsetY=0,this.contentHeight=this.calcContentHeight(),this.graphMidpoint=this.namesWidth+(s-this.namesWidth)/2,this.activeUser=null},t.Chrome.prototype={moveX:function(t){this.offsetX+=t,this.offsetX>this.graphMidpoint?this.offsetX=this.graphMidpoint:this.offsetX<this.graphMidpoint-20*this.commits.length&&(this.offsetX=this.graphMidpoint-20*this.commits.length)},moveY:function(t){this.offsetY+=t,this.offsetY>0||this.contentHeight<this.height-40?this.offsetY=0:this.offsetY<-this.contentHeight+this.height/2&&(this.offsetY=-this.contentHeight+this.height/2)},calcContentHeight:function(){for(var t=0,i=0;i<this.userBlocks.length;i++){var s=this.userBlocks[i];t+=s.count}return 20*t},hover:function(t,i){for(var s=0;s<this.userBlocks.length;s++){var e=this.userBlocks[s];if(t>0&&t<this.namesWidth&&i>40+this.offsetY+20*e.start&&i<40+this.offsetY+20*(e.start+e.count))return this.users[e.name]}return null},draw:function(){this.drawTimeline(this.ctx),this.drawUsers(this.ctx),this.drawFooter(this.ctx)},drawTimeline:function(t){t.fillStyle="#111111",t.fillRect(0,0,this.width,20),t.fillStyle="#333333",t.fillRect(0,20,this.width,20);var i=parseInt((0-this.offsetX)/20);0>i&&(i=0);var s=i+parseInt(this.width/20);s>this.commits.length&&(s=this.commits.length),t.save(),t.translate(this.offsetX,0),t.font="10px Helvetica, sans-serif";for(var e=null,h=null,o=i;s>o;o++){var a=this.commits[o],r=this.months[a.date.month()];r!=e&&(t.fillStyle="#ffffff",t.fillText(r,20*o-3,14),e=r);var n=parseInt(a.date.date());n!=h&&(t.fillStyle="#ffffff",t.fillText(n,20*o-3,33),h=n)}t.restore()},drawUsers:function(t){t.fillStyle="#FFFFFF",t.fillRect(0,0,this.namesWidth,this.height),t.save(),t.translate(0,40+this.offsetY);for(var i=0;i<this.userBlocks.length;i++){var s=this.userBlocks[i];t.fillStyle=this.userBgColors[i%2],t.fillRect(0,20*s.start,this.namesWidth,20*s.count),this.activeUser&&this.activeUser.name==s.name&&(t.fillStyle="rgba(0, 0, 0, 0.05)",t.fillRect(0,20*s.start,this.namesWidth,20*s.count)),t.fillStyle="#DDDDDD",t.fillRect(0,20*s.start,1,20*s.count),t.fillRect(this.namesWidth-1,20*s.start,1,20*s.count),t.fillRect(this.width-1,20*s.start,1,20*s.count),t.fillRect(0,20*(s.start+s.count)-1,this.namesWidth,1),t.measureText(s.name).width;var e=20*(s.start+s.count/2)+3;t.fillStyle="#000000",t.font="12px Monaco, monospace",t.textAlign="center",t.fillText(s.name,this.namesWidth/2,e,96)}t.restore(),t.fillStyle="#111111",t.fillRect(0,0,this.namesWidth,20),t.fillStyle="#333333",t.fillRect(0,20,this.namesWidth,20)},drawFooter:function(t){t.fillStyle="#F4F4F4",t.fillRect(0,this.height-20,this.width,20),t.fillStyle="#CCCCCC",t.fillRect(0,this.height-20,this.width,1),t.fillStyle="#000000",t.font="11px Monaco, monospace",t.fillText("GitHub Network Graph Viewer v4.0.0",5,this.height-5)}},t.Graph=function(t,i,s,e,h,o,a,r,n,c){this.namesWidth=100,this.spaceColors=[],this.bgColors=["#F5F5FF","#F0F0FF"],this.spaceColors.push("#FF0000"),this.spaceColors.push("#0000FF"),this.spaceColors.push("#00FF00"),this.spaceColors.push("#FF00FF"),this.spaceColors.push("#E2EB00"),this.spaceColors.push("#FFA600"),this.spaceColors.push("#00FFFC"),this.spaceColors.push("#DD458E"),this.spaceColors.push("#AD7331"),this.spaceColors.push("#97AD31"),this.spaceColors.push("#51829D"),this.spaceColors.push("#70387F"),this.spaceColors.push("#740000"),this.spaceColors.push("#745C00"),this.spaceColors.push("#419411"),this.spaceColors.push("#37BE8C"),this.spaceColors.push("#6C5BBD"),this.spaceColors.push("#F300AA"),this.spaceColors.push("#586D41"),this.spaceColors.push("#3B4E31"),this.network=t,this.ctx=i,this.width=s,this.height=e,this.focus=h,this.commits=o,this.users=a,this.spaceMap=r,this.userBlocks=n,this.nethash=c,this.offsetX=this.namesWidth+(s-this.namesWidth)/2-20*h,this.offsetY=0,this.bgCycle=0,this.marginMap={},this.gravatars={},this.activeCommit=null,this.contentHeight=this.calcContentHeight(),this.graphMidpoint=this.namesWidth+(s-this.namesWidth)/2,this.showRefs=!0,this.lastHotLoadCenterIndex=null,this.connectionMap={},this.spaceUserMap={};for(var l=0;l<n.length;l++)for(var m=n[l],f=m.start;f<m.start+m.count;f++)this.spaceUserMap[f]=a[m.name];this.headsMap={};for(var l=0;l<n.length;l++)for(var m=n[l],p=a[m.name],f=0;f<p.heads.length;f++){var u=p.heads[f];this.headsMap[u.id]||(this.headsMap[u.id]=[]);var d={name:p.name,head:u};this.headsMap[u.id].push(d)}},t.Graph.prototype={moveX:function(t){this.offsetX+=t,this.offsetX>this.graphMidpoint?this.offsetX=this.graphMidpoint:this.offsetX<this.graphMidpoint-20*this.commits.length&&(this.offsetX=this.graphMidpoint-20*this.commits.length),this.hotLoadCommits()},moveY:function(t){this.offsetY+=t,this.offsetY>0||this.contentHeight<this.height-40?this.offsetY=0:this.offsetY<-this.contentHeight+this.height/2&&(this.offsetY=-this.contentHeight+this.height/2)},toggleRefs:function(){this.showRefs=!this.showRefs},calcContentHeight:function(){for(var t=0,i=0;i<this.userBlocks.length;i++){var s=this.userBlocks[i];t+=s.count}return 20*t},hover:function(t,i){for(var s=this.timeWindow(),e=s.min;e<=s.max;e++){var h=this.commits[e],o=this.offsetX+20*h.time,a=this.offsetY+50+20*h.space;if(t>o-5&&o+5>t&&i>a-5&&a+5>i)return h}return null},hotLoadCommits:function(){var t=200,i=parseInt((-this.offsetX+this.graphMidpoint)/20);if(0>i&&(i=0),i>this.commits.length-1&&(i=this.commits.length-1),!(this.lastHotLoadCenterIndex&&Math.abs(this.lastHotLoadCenterIndex-i)<10)){this.lastHotLoadCenterIndex=i;var s=this.backSpan(i,t),e=this.frontSpan(i,t);if(s||e){var h=s?s[0]:e[0],o=e?e[1]:s[1];this.requestChunk(h,o)}}},backSpan:function(t,i){for(var s=null,e=t;e>=0&&e>t-i;e--)if(!this.commits[e].requested){s=e;break}if(null!=s){for(var h=null,o=null,e=s;e>=0&&e>s-i;e--)if(this.commits[e].requested){h=e;break}return h?o=h+1:(o=s-i,0>o&&(o=0)),[o,s]}return null},frontSpan:function(t,i){for(var s=null,e=t;e<this.commits.length&&t+i>e;e++)if(!this.commits[e].requested){s=e;break}if(null!=s){for(var h=null,o=null,e=s;e<this.commits.length&&s+i>e;e++)if(this.commits[e].requested){h=e;break}return o=h?h-1:s+i>=this.commits.length?this.commits.length-1:s+i,[s,o]}return null},requestInitialChunk:function(){var t=this;$.getJSON("network_data_chunk?nethash="+this.nethash,function(i){t.importChunk(i),t.draw(),t.network.chrome.draw()})},requestChunk:function(t,i){for(var s=t;i>=s;s++)this.commits[s].requested=new Date;var e=this,h="network_data_chunk?nethash="+this.nethash+"&start="+t+"&end="+i;$.getJSON(h,function(t){e.importChunk(t),e.draw(),e.network.chrome.draw(),e.lastHotLoadCenterIndex=this.focus})},importChunk:function(t){if(t.commits)for(var i=0;i<t.commits.length;i++){var s=t.commits[i],e=this.spaceUserMap[s.space],h=this.commits[s.time];h.populate(s,e,this.commits);for(var o=0;o<h.parents.length;o++)for(var a=h.parents[o],r=a.time+1;r<h.time;r++)this.connectionMap[r]=this.connectionMap[r]||[],this.connectionMap[r].push(h)}},timeWindow:function(){var t=parseInt((this.namesWidth-this.offsetX+20)/20);0>t&&(t=0);var i=t+parseInt((this.width-this.namesWidth)/20);return i>this.commits.length-1&&(i=this.commits.length-1),{min:t,max:i}},draw:function(){this.drawBackground();var t=this.timeWindow(),i=t.min,s=t.max;this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY+50);for(var e={},h=0;h<this.spaceMap.length;h++)for(var o=this.spaceMap.length-h-1,a=i;s>=a;a++){var r=this.commits[a];r.populated&&r.space==o&&(this.drawConnection(r),e[r.id]=!0)}for(var h=i;s>=h;h++){var n=this.connectionMap[h];if(n)for(var a=0;a<n.length;a++){var r=n[a];e[r.id]||(this.drawConnection(r),e[r.id]=!0)}}for(var h=0;h<this.spaceMap.length;h++)for(var o=this.spaceMap.length-h-1,a=i;s>=a;a++){var r=this.commits[a];r.populated&&r.space==o&&(r==this.activeCommit?this.drawActiveCommit(r):this.drawCommit(r))}if(this.showRefs)for(var a=i;s>=a;a++){var r=this.commits[a];if(r.populated){var c=this.headsMap[r.id];if(c)for(var l=0,m=0;m<c.length;m++){var f=c[m];if(this.spaceUserMap[r.space].name==f.name){var p=this.drawHead(r,f.head,l);l+=p}}}}this.ctx.restore(),this.activeCommit&&this.drawCommitInfo(this.activeCommit)},drawBackground:function(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.translate(0,this.offsetY+50),this.ctx.clearRect(0,-10,this.width,this.height);for(var t=0;t<this.userBlocks.length;t++){var i=this.userBlocks[t];this.ctx.fillStyle=this.bgColors[t%2],this.ctx.fillRect(0,20*i.start-10,this.width,20*i.count),this.ctx.fillStyle="#DDDDDD",this.ctx.fillRect(0,20*(i.start+i.count)-11,this.width,1)}this.ctx.restore()},drawCommit:function(t){var i=20*t.time;y=20*t.space,this.ctx.beginPath(),this.ctx.arc(i,y,3,0,2*Math.PI,!1),this.ctx.fillStyle=this.spaceColor(t.space),this.ctx.fill()},drawActiveCommit:function(t){var i=20*t.time,s=20*t.space;this.ctx.beginPath(),this.ctx.arc(i,s,6,0,2*Math.PI,!1),this.ctx.fillStyle=this.spaceColor(t.space),this.ctx.fill()},drawCommitInfo:function(t){var i=t.message?this.splitLines(t.message,54):[],s=80+15*i.length,e=this.offsetX+20*t.time,h=50+this.offsetY+20*t.space,o=0,a=0;o=e<this.graphMidpoint?e+10:e-410,a=h<40+(this.height-40)/2?h+10:h-s-10,this.ctx.save(),this.ctx.translate(o,a),this.ctx.fillStyle="#FFFFFF",this.ctx.strokeStyle="#000000",this.ctx.lineWidth="2",this.ctx.beginPath(),this.ctx.moveTo(0,5),this.ctx.quadraticCurveTo(0,0,5,0),this.ctx.lineTo(395,0),this.ctx.quadraticCurveTo(400,0,400,5),this.ctx.lineTo(400,s-5),this.ctx.quadraticCurveTo(400,s,395,s),this.ctx.lineTo(5,s),this.ctx.quadraticCurveTo(0,s,0,s-5),this.ctx.lineTo(0,5),this.ctx.fill(),this.ctx.stroke();var r=this.gravatars[t.gravatar];if(r)this.drawGravatar(r,10,10);else{var n=this;window.location.protocol,r=new Image,r.src=t.gravatar,r.onload=function(){n.activeCommit==t&&(n.drawGravatar(r,o+10,a+10),n.gravatars[t.gravatar]=r)}}this.ctx.fillStyle="#000000",this.ctx.font="bold 14px Helvetica, sans-serif",this.ctx.fillText(t.author,55,32),this.ctx.fillStyle="#888888",this.ctx.font="12px Monaco, monospace",this.ctx.fillText(t.id,12,65),this.drawMessage(i,12,85),this.ctx.restore()},drawGravatar:function(t,i,s){this.ctx.strokeStyle="#AAAAAA",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.strokeRect(i+.5,s+.5,35,35),this.ctx.drawImage(t,i+2,s+2,32,32)},drawMessage:function(t,i,s){this.ctx.font="12px Monaco, monospace",this.ctx.fillStyle="#000000";for(var e=0;e<t.length;e++){var h=t[e];this.ctx.fillText(h,i,s+15*e)}},splitLines:function(t,i){for(var s=t.split(" "),e=[],h="",o=0;o<s.length;o++){var a=s[o];h.length+1+a.length<i?h=""==h?a:h+" "+a:(e.push(h),h=a)}return e.push(h),e},drawHead:function(t,i,s){this.ctx.font="10.25px Monaco, monospace",this.ctx.save();var e=this.ctx.measureText(i.name).width;this.ctx.restore();var h=20*t.time,o=20*t.space+5+s;return this.ctx.save(),this.ctx.translate(h,o),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(-4,10),this.ctx.quadraticCurveTo(-9,10,-9,15),this.ctx.lineTo(-9,15+e),this.ctx.quadraticCurveTo(-9,15+e+5,-4,15+e+5),this.ctx.lineTo(4,15+e+5),this.ctx.quadraticCurveTo(9,15+e+5,9,15+e),this.ctx.lineTo(9,15),this.ctx.quadraticCurveTo(9,10,4,10),this.ctx.lineTo(0,0),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Monaco, monospace",this.ctx.textBaseline="middle",this.ctx.scale(.85,.85),this.ctx.rotate(Math.PI/2),this.ctx.fillText(i.name,17,-1),this.ctx.restore(),e+20},drawConnection:function(t){for(var i=0;i<t.parents.length;i++){var s=t.parents[i];0==i?s.space==t.space?this.drawBasicConnection(s,t):this.drawBranchConnection(s,t):this.drawMergeConnection(s,t)}},drawBasicConnection:function(t,i){var s=this.spaceColor(i.space);this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(20*t.time,20*i.space),this.ctx.lineTo(20*i.time,20*i.space),this.ctx.stroke()},drawBranchConnection:function(t,i){var s=this.spaceColor(i.space);this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(20*t.time,20*t.space),this.ctx.lineTo(20*t.time,20*i.space),this.ctx.lineTo(20*i.time-14,20*i.space),this.ctx.stroke(),this.threeClockArrow(s,20*i.time,20*i.space)},drawMergeConnection:function(t,i){var s=this.spaceColor(t.space);if(this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.beginPath(),t.space>i.space){this.ctx.moveTo(20*t.time,20*t.space);var e=this.safePath(t.time,i.time,t.space);if(e)this.ctx.lineTo(20*i.time-10,20*t.space),this.ctx.lineTo(20*i.time-10,20*i.space+15),this.ctx.lineTo(20*i.time-7.7,20*i.space+9.5),this.ctx.stroke(),this.oneClockArrow(s,20*i.time,20*i.space);else{var h=this.closestMargin(t.time,i.time,t.space,-1);t.space==i.space+1&&t.space==h+1?(this.ctx.lineTo(20*t.time,20*h+10),this.ctx.lineTo(20*i.time-15,20*h+10),this.ctx.lineTo(20*i.time-9.5,20*h+7.7),this.ctx.stroke(),this.twoClockArrow(s,20*i.time,20*h),this.addMargin(t.time,i.time,h)):t.time+1==i.time?(h=this.closestMargin(t.time,i.time,i.space,0),this.ctx.lineTo(20*t.time,20*h+10),this.ctx.lineTo(20*i.time-15,20*h+10),this.ctx.lineTo(20*i.time-15,20*i.space+10),this.ctx.lineTo(20*i.time-9.5,20*i.space+7.7),this.ctx.stroke(),this.twoClockArrow(s,20*i.time,20*i.space),this.addMargin(t.time,i.time,h)):(this.ctx.lineTo(20*t.time+10,20*t.space-10),this.ctx.lineTo(20*t.time+10,20*h+10),this.ctx.lineTo(20*i.time-10,20*h+10),this.ctx.lineTo(20*i.time-10,20*i.space+15),this.ctx.lineTo(20*i.time-7.7,20*i.space+9.5),this.ctx.stroke(),this.oneClockArrow(s,20*i.time,20*i.space),this.addMargin(t.time,i.time,h))}}else{var h=this.closestMargin(t.time,i.time,i.space,-1);h<i.space?(this.ctx.moveTo(20*t.time,20*t.space),this.ctx.lineTo(20*t.time,20*h+10),this.ctx.lineTo(20*i.time-12.7,20*h+10),this.ctx.lineTo(20*i.time-12.7,20*i.space-10),this.ctx.lineTo(20*i.time-9.4,20*i.space-7.7),this.ctx.stroke(),this.fourClockArrow(s,20*i.time,20*i.space),this.addMargin(t.time,i.time,h)):(this.ctx.moveTo(20*t.time,20*t.space),this.ctx.lineTo(20*t.time,20*h+10),this.ctx.lineTo(20*i.time-12.7,20*h+10),this.ctx.lineTo(20*i.time-12.7,20*i.space+10),this.ctx.lineTo(20*i.time-9.4,20*i.space+7.7),this.ctx.stroke(),this.twoClockArrow(s,20*i.time,20*i.space),this.addMargin(t.time,i.time,h))}},addMargin:function(t,i,s){var e=s;this.marginMap[e]||(this.marginMap[e]=[]),this.marginMap[e].push([t,i])},oneClockArrow:function(t,i,s){this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.moveTo(i-6.3,s+13.1),this.ctx.lineTo(i-10.8,s+9.7),this.ctx.lineTo(i-2.6,s+3.5),this.ctx.fill()},twoClockArrow:function(t,i,s){this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.moveTo(i-12.4,s+6.6),this.ctx.lineTo(i-9.3,s+10.6),this.ctx.lineTo(i-3.2,s+2.4),this.ctx.fill()},threeClockArrow:function(t,i,s){this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.moveTo(i-14,s-2.5),this.ctx.lineTo(i-14,s+2.5),this.ctx.lineTo(i-4,s),this.ctx.fill()},fourClockArrow:function(t,i,s){this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.moveTo(i-12.4,s-6.6),this.ctx.lineTo(i-9.3,s-10.6),this.ctx.lineTo(i-3.2,s-2.4),this.ctx.fill()},safePath:function(t,i,s){for(var e=0;e<this.spaceMap[s].length;e++){var h=this.spaceMap[s][e];if(this.timeInPath(t,h))return h[1]==i}return!1},closestMargin:function(t,i,s,e){for(var h=this.spaceMap.length,o=e,a=!1,r=!1,n=!1;!r||!a;){if(s+o>=0&&this.safeMargin(t,i,s+o))return s+o;0>s+o&&(a=!0),s+o>h&&(r=!0),0==n&&0==o?(o=-1,n=!0):o=0>o?-o-1:-o-2}return s>0?s-1:0},safeMargin:function(t,i,s){var e=s;if(!this.marginMap[e])return!0;for(var h=this.marginMap[e],o=0;o<h.length;o++){var a=h[o];if(this.pathsCollide([t,i],a))return!1}return!0},pathsCollide:function(t,i){return this.timeWithinPath(t[0],i)||this.timeWithinPath(t[1],i)||this.timeWithinPath(i[0],t)||this.timeWithinPath(i[1],t)},timeInPath:function(t,i){return t>=i[0]&&t<=i[1]},timeWithinPath:function(t,i){return t>i[0]&&t<i[1]},spaceColor:function(t){return 0==t?"#000000":this.spaceColors[t%this.spaceColors.length]}},t.MouseDriver=function(t,i,s){this.containerSelector=t,this.chrome=i,this.graph=s,this.dragging=!1,this.lastPoint={x:0,y:0},this.lastHoverCommit=null,this.lastHoverUser=null,this.pressedCommit=null,this.pressedUser=null;var e=$(t).eq(0),h=$("canvas",e)[0],o=$(h).offset();h.style.cursor="move";var a=this;this.up=function(){a.dragging=!1,a.pressedCommit&&a.graph.activeCommit==a.pressedCommit?window.open("/"+a.graph.activeCommit.user.name+"/"+a.graph.activeCommit.user.repo+"/commit/"+a.graph.activeCommit.id):a.pressedUser&&a.chrome.activeUser==a.pressedUser&&(window.location="/"+a.chrome.activeUser.name+"/"+a.chrome.activeUser.repo+"/network"),a.pressedCommit=null,a.pressedUser=null},this.down=function(){a.graph.activeCommit?a.pressedCommit=a.graph.activeCommit:a.chrome.activeUser?a.pressedUser=a.chrome.activeUser:a.dragging=!0},this.docmove=function(t){var i=t.pageX,s=t.pageY;a.dragging&&(a.graph.moveX(i-a.lastPoint.x),a.graph.moveY(s-a.lastPoint.y),a.graph.draw(),a.chrome.moveX(i-a.lastPoint.x),a.chrome.moveY(s-a.lastPoint.y),a.chrome.draw()),a.lastPoint.x=i,a.lastPoint.y=s},this.move=function(t){var i=t.pageX,s=t.pageY;if(a.dragging)a.graph.moveX(i-a.lastPoint.x),a.graph.moveY(s-a.lastPoint.y),a.graph.draw(),a.chrome.moveX(i-a.lastPoint.x),a.chrome.moveY(s-a.lastPoint.y),a.chrome.draw();else{var e=a.chrome.hover(i-o.left,s-o.top);if(e!=a.lastHoverUser)h.style.cursor=e?"pointer":"move",a.chrome.activeUser=e,a.chrome.draw(),a.lastHoverUser=e;else{var r=a.graph.hover(i-o.left,s-o.top);r!=a.lastHoverCommit&&(h.style.cursor=r?"pointer":"move",a.graph.activeCommit=r,a.graph.draw(),a.chrome.draw(),a.lastHoverCommit=r)}}a.lastPoint.x=i,a.lastPoint.y=s},this.out=function(){a.graph.activeCommit=null,a.chrome.activeUser=null,a.graph.draw(),a.chrome.draw(),a.lastHoverCommit=null,a.lastHoverUser=null},$("body")[0].onmouseup=this.up,$("body")[0].onmousemove=this.docmove,h.onmousedown=this.down,h.onmousemove=this.move,h.onmouseout=this.out},t.KeyDriver=function(t,i,s){this.containerSelector=t,this.chrome=i,this.graph=s,this.dirty=!1,this.moveBothX=function(t){this.graph.moveX(t),this.chrome.moveX(t),this.graph.activeCommit=null,this.dirty=!0},this.moveBothY=function(t){this.graph.moveY(t),this.chrome.moveY(t),this.graph.activeCommit=null,this.dirty=!0},this.toggleRefs=function(){this.graph.toggleRefs(),this.dirty=!0},this.redraw=function(){this.dirty&&(this.graph.draw(),this.chrome.draw()),this.dirty=!1};var e=this;this.down=function(t){var i=!1;if(t.target!=document.body)return!0;if(t.shiftKey)switch(t.which){case 37:case 72:e.moveBothX(999999),i=!0;break;case 38:case 75:e.moveBothY(999999),i=!0;break;case 39:case 76:e.moveBothX(-999999),i=!0;break;case 40:case 74:e.moveBothY(-999999),i=!0}else switch(t.which){case 37:case 72:e.moveBothX(100),i=!0;break;case 38:case 75:e.moveBothY(20),i=!0;break;case 39:case 76:e.moveBothX(-100),i=!0;break;case 40:case 74:e.moveBothY(-20),i=!0;break;case 84:e.toggleRefs(),i=!0}i&&e.redraw()},$(document).keydown(this.down)},$(".js-network-graph-container")[0]&&new t(".js-network-graph-container",920,600)}),function(){}.call(this);